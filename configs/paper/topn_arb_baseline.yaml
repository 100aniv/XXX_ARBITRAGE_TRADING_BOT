# D77-0: TopN Arbitrage PAPER Baseline Configuration
# Top20/Top50 심볼 대상 Full Cycle (Entry → Exit → PnL) PAPER 검증
#
# Purpose:
# - Critical Gaps 4개 해소 (Q1~Q4)
# - Top50+ PAPER 1h+ 실행
# - Entry/Exit Full Cycle 검증
# - D75 Infrastructure (ArbRoute, Universe, CrossSync, RiskGuard) 실제 시장 통합 검증
# - Alert Manager (D76) 실제 Telegram 전송 검증
# - Core KPI 10종 수집
#
# Key Features:
# - TopN Universe Provider (거래량/유동성/스프레드 기반)
# - Exit Strategy (TP/SL/Time-based/Spread reversal)
# - D75/D76 Infrastructure 전부 통합
# - 1h/12h 둘 다 지원

# Environment
env: "paper"

# Exchange Configuration (Paper Mode)
exchange:
  upbit_access_key: "paper_mock"
  upbit_secret_key: "paper_mock"
  binance_api_key: "paper_mock"
  binance_secret_key: "paper_mock"

# Database Configuration
database:
  postgres_host: "localhost"
  postgres_port: 5432
  postgres_dbname: "arbitrage_lite"
  postgres_user: "postgres"
  postgres_password: "postgres"
  redis_host: "localhost"
  redis_port: 6380  # arbitrage-redis port
  redis_db: 0

# Risk Configuration
risk:
  max_notional_per_trade: 1000.0
  max_daily_loss: 5000.0
  max_open_trades: 50  # TopN 심볼에 대해 충분한 여유

# Trading Configuration
trading:
  min_spread_bps: 15.0  # 0.15% (fees 0.06% + slippage 0.05% = 0.11% 대비 여유)
  taker_fee_a_bps: 5.0  # 0.05% (Upbit)
  taker_fee_b_bps: 1.0  # 0.01% (Binance)
  slippage_bps: 5.0  # 0.05%
  close_on_spread_reversal: true

# Monitoring Configuration
monitoring:
  metrics_enabled: true
  metrics_interval_seconds: 300  # 5 minutes
  log_level: "INFO"

# Session Configuration
session:
  mode: "paper"
  data_source: "paper"
  max_runtime_seconds: 3600  # 1h (default, can override via CLI)
  loop_interval_ms: 100  # 0.1s
  state_persistence_enabled: false
  snapshot_interval_seconds: 600  # 10 minutes

# D77-0: TopN Universe Configuration
universe:
  mode: "TOP_N"
  top_n: 20  # default: TOP_20 (can override: 10/20/50/100)
  base_quote: "USDT"
  blacklist: ["BUSDUSDT", "USDCUSDT", "TUSDUSDT", "USDPUSDT"]  # Stablecoin 제외
  min_24h_quote_volume: 1000000.0  # $1M
  min_liquidity_depth: 50000.0  # $50K
  max_spread_bps: 50.0  # 0.5%
  refresh_interval_seconds: 3600  # 1h (Dynamic universe update)
  max_churn_rate: 0.10  # 10% max symbol change per update

# Engine Configuration
engine:
  mode: "multi"
  multi_symbol_enabled: true
  per_symbol_isolation: true

# D75: Multi-Symbol RiskGuard Configuration
multi_symbol_risk_guard:
  # Global Guard
  max_total_exposure_usd: 10000.0
  max_daily_loss_usd: 3000.0
  emergency_stop_loss_usd: 5000.0
  
  # Portfolio Guard
  total_capital_usd: 10000.0
  max_symbol_allocation_pct: 0.30  # 심볼당 30%
  
  # Symbol Guard
  max_position_size_usd: 1000.0
  max_position_count: 5  # 심볼당 5 포지션
  cooldown_seconds: 30.0
  max_symbol_daily_loss_usd: 500.0
  circuit_breaker_loss_count: 3  # 3회 연속 손실 시 차단
  circuit_breaker_duration: 300.0  # 5분 차단

# D75: ArbRoute Configuration
arb_route:
  min_route_score: 60.0  # 최소 route score (0~100)
  spread_weight: 0.40
  health_weight: 0.30
  fee_weight: 0.20
  inventory_weight: 0.10

# D75: Rate Limiter Configuration
rate_limiter:
  upbit_hard_limit_per_second: 8
  upbit_soft_limit_per_second: 5
  binance_hard_limit_per_second: 10
  binance_soft_limit_per_second: 7
  token_bucket_refill_rate: 1.0

# D75: Exchange Health Monitor Configuration
health_monitor:
  ping_interval_seconds: 30
  degraded_threshold_ms: 500
  down_threshold_ms: 2000
  max_consecutive_failures: 3

# D75: CrossSync Configuration
cross_sync:
  sync_interval_seconds: 60
  max_imbalance_pct: 30.0  # 30% imbalance → alert
  max_exposure_usd: 10000.0

# D76: Alert Manager Configuration
alert_manager:
  enabled: true
  telegram_bot_token: "${TELEGRAM_BOT_TOKEN}"  # Environment variable
  telegram_chat_id: "${TELEGRAM_CHAT_ID}"
  alert_environment: "PAPER"  # PROD/DEV/PAPER
  rate_limit_p0_per_min: 10
  rate_limit_p1_per_min: 5
  rate_limit_p2_per_min: 3
  rate_limit_p3_per_min: 1

# D77-0: Exit Strategy Configuration
exit_strategy:
  tp_threshold_pct: 0.25  # 0.25% TP
  sl_threshold_pct: 0.20  # 0.20% SL
  max_hold_time_seconds: 180.0  # 3 minutes
  spread_reversal_threshold_bps: -10.0  # -10 bps (spread turned negative)

# D77-0: Core KPI Collection Configuration
kpi_collection:
  enabled: true
  collection_interval_seconds: 300  # 5 minutes
  output_format: "json"  # json/csv
  output_path: "logs/d77-0/kpi/"

# D77-0 Specific Settings
d77_0_baseline:
  campaign_duration_seconds: 3600  # 1h (default, can override)
  target_universe_mode: "TOP_20"  # TOP_10/TOP_20/TOP_50/TOP_100
  target_min_round_trips: 5  # 최소 5개 Entry → Exit 완료
  target_min_win_rate_pct: 50.0  # 최소 50% 승률
  target_min_alerts: 1  # 최소 1개 alert 발생
  enable_exit_strategy: true
  enable_d75_integration: true
  enable_d76_integration: true
  enable_detailed_logging: true
  enable_performance_metrics: true
