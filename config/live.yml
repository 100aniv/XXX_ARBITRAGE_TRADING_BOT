# Live API Configuration (PHASE D4)
# ====================================
# 실거래 모드 설정 (credentials 포함)
# 
# 주의:
# - 이 파일은 .gitignore에 포함되어야 함
# - API KEY/SECRET을 절대 공개하지 말 것
# - 환경 변수로 오버라이드 가능

upbit:
  enabled: false  # 실거래 활성화 여부
  api_key: ""     # 환경 변수: UPBIT_API_KEY
  api_secret: ""  # 환경 변수: UPBIT_API_SECRET
  rest_url: "https://api.upbit.com"
  ws_url: "wss://api.upbit.com/websocket/v1"
  rate_limit:
    requests_per_second: 10
    burst_size: 20

binance:
  enabled: false  # 실거래 활성화 여부
  api_key: ""     # 환경 변수: BINANCE_API_KEY
  api_secret: ""  # 환경 변수: BINANCE_API_SECRET
  rest_url: "https://api.binance.com"
  ws_url: "wss://stream.binance.com:9443"
  rate_limit:
    requests_per_second: 10
    burst_size: 20

# 모드 설정 (PHASE D10)
mode:
  # 실행 모드: mock | paper | live
  # - mock: 완전 시뮬레이션, 실제 API 호출 없음
  # - paper: 실제 시세, 모의 주문
  # - live: 실제 시세 + 실제 주문 (강력한 보호 필수)
  current: "mock"

# 실거래 보호 (PHASE D10)
live_guards:
  require_env_flag: true              # LIVE_TRADING=1 환경 변수 필수
  require_manual_confirm_file: true   # .live_trading_ok 파일 필수
  require_safety_pass: true           # D8 안전 검증 필수
  dry_run_on_startup: true            # 시작 시 드라이런 강제
  dry_run_cycles: 3                   # 드라이런 사이클 수

# 시그널 엔진 (PHASE D7)
signal_engine:
  min_spread_pct: 0.5  # 최소 차익률 (%)
  upbit_fee: 0.25  # Upbit 수수료 (%)
  binance_fee: 0.1  # Binance 수수료 (%)
  slippage_pct: 0.2  # 슬리피지 (%)
  min_trade_amount_krw: 10000  # 최소 거래량 (KRW)

# 실행 엔진 (PHASE D7)
execution_engine:
  position_size_krw: 100000  # 포지션 사이즈 (KRW)
  position_size_btc: 0.01  # 포지션 사이즈 (BTC)
  max_retries: 3  # 최대 재시도
  retry_delay: 1  # 재시도 간격 (초)

# 주문 관리자 (PHASE D7)
order_manager:
  max_retries: 3
  retry_delay: 1
  order_timeout: 60  # 주문 타임아웃 (초)
  slippage_tolerance: 0.5  # 슬리피지 허용 범위 (%)

# 안전장치 (PHASE D8)
safety:
  max_slippage_pct: 0.30  # 최대 슬리피지 (%)
  max_order_delay_ms: 2500  # 최대 주문 지연 (ms)
  max_position_size_krw: 300000  # 최대 포지션 사이즈 (KRW)
  max_daily_loss_krw: 150000  # 최대 일일 손실 (KRW)
  min_liquidity_krw: 20000000  # 최소 유동성 (KRW)
  require_ws_freshness: true  # WebSocket 신선도 필수
  require_redis_heartbeat: true  # Redis heartbeat 필수

# 포지션 엔진 (PHASE D9)
position_engine:
  max_open_positions: 5  # 최대 열린 포지션 수
  max_exposure_krw: 1000000  # 최대 노출도 (KRW)
  max_daily_loss_krw: 150000  # 최대 일일 손실 (KRW)

# 손절매 엔진 (PHASE D9)
stoploss:
  enabled: true  # 손절매 활성화
  mode: "static"  # static | dynamic
  static_pct: 1.2  # 정적 손절매 (%)
  atr_window: 20  # 동적 손절매 윈도우

# 리밸런싱 엔진 (PHASE D9)
rebalancer:
  enabled: true  # 리밸런싱 활성화
  max_exposure_krw: 600000  # 최대 노출도 (KRW)
  reduce_pct: 0.3  # 감소 비율 (%)

# 알림 시스템 (PHASE D9 + D10)
alert:
  enabled: true  # 알림 활성화
  telegram_enabled: false  # Telegram 실제 연동 (API 키 필요)
  telegram:
    bot_token: ""          # 환경 변수: TELEGRAM_BOT_TOKEN
    chat_id: ""            # 환경 변수: TELEGRAM_CHAT_ID
    timeout_seconds: 5     # Telegram API 타임아웃

# WebSocket 실시간 시세 (PHASE D6)
websocket:
  enabled: true
  upbit_symbols:
    - "BTC-KRW"
    - "ETH-KRW"
  binance_symbols:
    - "BTCUSDT"
    - "ETHUSDT"
  reconnect_interval: 5  # 초

# 메트릭 서버
metrics_server:
  enabled: true
  host: "0.0.0.0"
  port: 8000
  path: "/metrics"

# 로깅 (PHASE D11)
logging:
  level: "INFO"  # DEBUG | INFO | WARNING | ERROR
  file: "logs/live.log"

# 시스템 모니터 (PHASE D11)
sys_monitor:
  enabled: true                   # psutil 기반 리소스 모니터링 활성화
  max_cpu_pct: 90.0              # CPU 임계치 (%)
  max_rss_mb: 2048.0             # 메모리 임계치 (MB)
  warn_cpu_pct: 75.0             # CPU 경고 임계치 (%)
  warn_rss_mb: 1536.0            # 메모리 경고 임계치 (MB)
  sample_interval_sec: 30.0      # 샘플 간격 (초)

# 워치독 (PHASE D11 + D12)
watchdog:
  enabled: true                   # 워치독 활성화
  max_ws_lag_ms: 5000.0          # 최대 WS 지연 (ms)
  ws_lag_warn_threshold_ms: 2000.0
  max_redis_heartbeat_age_ms: 30000.0
  redis_heartbeat_warn_threshold_ms: 15000.0
  max_loop_latency_ms: 5000.0
  loop_latency_warn_threshold_ms: 2000.0
  max_safety_rejections_per_minute: 10
  max_live_errors_per_minute: 5
  # D12: 튜닝 & Auto-reset
  warn_reset_cycles: 5            # WARN 상태 자동 리셋 사이클 수
  error_reset_cycles: 20          # ERROR 상태 자동 리셋 사이클 수
  cooldown_after_critical: 60.0   # CRITICAL 후 쿨다운 (초)

# 장시간 안정성 테스트 (PHASE D12)
longrun:
  enabled: true                   # 장시간 테스트 활성화
  interval_loops: 50              # 스냅샷 저장 간격 (루프 수)
  snapshot_path: "logs/stability" # 스냅샷 저장 경로
